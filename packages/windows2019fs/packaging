$ErrorActionPreference = "Stop";
trap { $host.SetShouldExit(1) }

# Lookup target of symlink, otherwise untar will fail
$drive = (Get-item "C:\var\vcap\data").Target
$target = (Resolve-Path "${env:BOSH_INSTALL_TARGET}" | Get-Item).Target
$resolved_bosh_install_target = ("${target}" -Replace "C:\\var\\vcap\\data\\","${drive}")
$rootfs_tarball_path = (Get-Item windows2019fs\windows2016fs-*.tgz).FullName

New-Item -ItemType Directory -Force -Path "${resolved_bosh_install_target}"
Push-Location "${resolved_bosh_install_target}"
    tar -xzf "${rootfs_tarball_path}"
    if ($LastExitCode -ne 0) {
        Write-Host "extracting tarball failed"
        Exit $LastExitCode
    }
Pop-Location

exit 0
